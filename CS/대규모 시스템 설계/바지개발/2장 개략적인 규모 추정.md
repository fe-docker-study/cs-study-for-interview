# 2장 개략적인 규모 추정

- 시스템 용량이나 성능 요구사항을 개략적으로 추정하는 것
- 보편적으로 통용되는 성능 수치상에서 사고실험을 행해 추정치를 계산



## 2의 제곱수

- 데이터 볼륨의 단위를 2의 제곱수로 표현한 수치를 알아야 함
- 최소 단위는 1바이트이고, 8비트로 구성
- ASCII 문자 하나가 차지하는 메모리 크기는 1바이트

| 2의 x 제곱 | 근사치             | 이름                  | 축약형 |
| ---------- | ------------------ | --------------------- | ------ |
| 10         | 1천만(thousand)    | 1킬로바이트(Kilobyte) | 1KB    |
| 20         | 1백만(milion)      | 1메가바이트(Megabyte) | 1MB    |
| 30         | 10억(bilion)       | 1기가바이트(Gigabyte) | 1GB    |
| 40         | 1조(trilion)       | 1테라바이트(Terabyte) | 1TB    |
| 50         | 1000조(quadrilion) | 1페타바이트(Petabyte) | 1PB    |



## 응답지연

| 연산명                                                       | 시간                  |
| ------------------------------------------------------------ | --------------------- |
| L1 캐시 참조                                                 | 0.5ns                 |
| 분기 예측 오류(branch mispredict)                            | 5ns                   |
| L2 캐시 참조                                                 | 7ns                   |
| 뮤텍스(mutex) 락/언락                                        | 100ns                 |
| 주 메모리 참조                                               | 100ns                 |
| Zippy로 1 KB 압축                                            | 10,000ns = 10µs       |
| 1 Gbps 네트워크로 2 KB 전송                                  | 20,000ns = 20µs       |
| 메모리에서 1 MB 순차적으로 read                              | 250,000ns = 250µs     |
| 같은 데이터 센터 내에서 메시지 왕복 지연시간                 | 500,000ns = 500µs     |
| 디스크 탐색(seek)                                            | 10,000,000ns = 10ms   |
| 네트워크에서 1 MB 순차적으로 read                            | 10,000,000ns = 10ms   |
| 디스크에서 1 MB 순차적으로 read                              | 30,000,000ns = 30ms   |
| 한 패킷의 CA(캘리포니아)로부터 네덜란드까지의 왕복 지연 시간 | 150,000,000ns = 150ms |

- ns = nanosecond(나노초)

- µs = microsecond(마이크로초)

- ms = milisecond(밀리초)

- 1나노초 = 10^-9초

- 1마이크로초 = 10^-6초 = 1,000 나노초

- 1밀리초 = 10^-3 초 = 1,000µs = 1,000,000ns

  

![Untitled](https://user-images.githubusercontent.com/90545926/180793920-a7c68c3c-8552-47b0-9dc8-172016cbf339.png)

→  메모리는 빠르지만 디스크는 느리다

→ 디스크 탐색(Disk seek)은 가능한 피하라

→ 단순한 압축 알고리즘은 빠르다

→ 인터넷으로 전송하기 전에 가능한 압축하라

→ 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고 받는데는 시간이 걸린다.




- 응답시간 : 클라이언트 관점에서 본 시간. 요청을 처리하는 실제 시간(서비스 시간) 외에도 네트워크 지연과 큐 지연도 포함(응답시간=지연시간+연산시간)
- 지연 시간 : 요청이 처리되길 기다리는 시간. 서비스를 기다리며 휴지 상태인 시간
  - 지연시간은 성능의 주요 병목점이며, 특히 서버까지 많은 왕복이 이뤄지는 HTTP와 같은 프로토콜에서 성능 큰 영향
  - 지연 시간에 영향을 미치는 두 가지 주요 요인: 1.두 지점 사이의 거리, 2.사용하는전송 매체의 속도



## 가용성

- 고가용성(high availability) : 시스템이 오랜 시간 동안 지속적으로 중단없이 운영될 수 있는 능력을 지칭

- 고가용성을 표현하는 단위는 퍼센트로 100%는 시스템이 한 번도 중단된 적이 없음을 의미

- 관습적으로 9를 사용해 표시

- SLA(Service Level Agreement)

  - 서비스 사업자가 보편적으로 사용하는 용어로 서비스 사업자와 고객 사이에 맺어진 합의

  - 서비스 사업자가 제공하는 서비스의 가용시간(uptime)이 공식적으로 기술됨

    | 가용률   | 하루당 장애시간 | 주당 장애시간 | 개월당 장애시간 | 연간 장애시간 |
    | -------- | --------------- | ------------- | --------------- | ------------- |
    | 99%      | 14.40분         | 1.68시간      | 7.31시간        | 3.65인        |
    | 99.9%    | 1.44분          | 10.08분       | 43.83분         | 8.77시간      |
    | 99.99%   | 8.64초          | 1.01분        | 4.38분          | 52.60분       |
    | 99.999%  | 864.00밀리초    | 6.05초        | 26.30초         | 5.26분        |
    | 99.9999% | 86.40밀리초     | 604.80밀리초  | 2.63초          | 31.56초       |



## **예제 : 트위터 QPS와 저장소 요구량 추정**

### **가정**

- 월간 능동 사용자(monthly active user)는 3억(300milion) 명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗은 10% 정도다.
- 데이터는 5년간 보관된다.

### **추정**

QPS(Query Per Second) 추정치

- 일간 능동 사용자(Daily Active User, DAU) = 3억 x 50% = 1.5억(150milion)
- QPS = 1.5억 X 2 트윗 / 24시간 /3600초 = 약 3500
- 최대 QPS(Peek QPS) = 2 x QPS = 약 7000

### **미디어 저장을 위한 저장소 요구량**

- 평균 트윗 크기
  - tweet_id에 64바이트
  - 텍스트에 140바이트
  - 미디어에 1MB
- 미디어 저장소 요구량 : 1.5억 x 2 x 10% x 1MB = 30TB /일
- 5년간 미디어를 보관하기 위한 저장소 요구량 : 30TB X 365 X 5 = 약 55PB



## 팁

### 근사치를 활용한 계산(rounding and approximation)

- 적절한 근사치를 활용 : 99987/9.1 → 100000/10
- 나중에 살펴보도록 가정(assumption)들은 적어두기
- 단위(unit)을 붙이는 습관을 들여 모호함을 방지
- 많이 출제되는 개략적 규모추정 문제는 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정