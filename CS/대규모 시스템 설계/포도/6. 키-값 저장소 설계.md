# 키-값 저장소 설계

키-값 저장소는 키-값 데이터베이스라고도 불리는 비 관계형 데이터베이스이다. 이 저장소에 저장되는 값은 고유 식별자를 키로 가져야 한다. 키과 값 사이의 이런 연결 관계를 "키-값" 쌍이라고 지칭한다.

키-값 쌍에서 키는 유일해야 하며 해당 키에 매칭되는 값은 키를 통해서만 접근할 수 있다. 키는 일반 텍스트일 수도 있고 해시 값일 수도 있다. 성능 상의 이유로 키는 짧을수록 좋다.

키-값 쌍에서 값은 문자열일 수도 있고 리스트일 수도 있고 객체일 수도 있다. 키-값 저장소로 널리 알려진 것으로는 아마존 다이나모, memcached, 레디스 등이 있다. 

키-값 저장소는 다음 연산을 지원한다.

- put(key, value) : 키-값 쌍을 저장소에 저장한다.
- get(key) : 인자로 주어진 키와 매칭되는 값을 꺼낸다.

<br>



## 단일 서버 키-값 저장소

한 대 서버만 사용하는 키-값 저장소를 설계하는 가장 직관적인 방법은 키-값 쌍 전부를 메모리에 해시 테이블로 저장하는 것이다. 그러나 이렇게 하면 속도는 빠르지만, 모든 데이터를 메모리 안에 두는 것이 불가능할 수도 있다. 이 문제를 해결하기 위한 개선책으로는 다음과 같은 것이 있다.

- 데이터 압축
- 자주 쓰이는 데이터만 메모리에 두고 나머지는 디스크에 저장

그러나 개선한다고 해도 서버 한 대로는 부족한 때가 찾아오기 때문에 많은 데이터를 저장하기 위해서는 분산 키-값 저장소를 만들어야 한다.

<br>



## 분산 키-값 저장소

분산 키-값 저장소는 분산 해시 테이블이라고도 불린다. 키-값 쌍을 여러 서버에 분산시키기 때문이다. 분산 시스템을 설계할 때는 CAP 정리(Consistency, Availability, Partition Tolerance theorem)를 이해하고 있어야 한다.

<br>



### CAP 정리

CAP 정리는 데이터 일관성, 가용성, 파티션 감내하는 세 가지 요구사항을 동시에 만족하는 분산 시스템을 설계하는 것은 불가능하다는 정리이다.

- 데이터 일관성 : 분산 시스템에 접속하는 모든 클라이언트는 어떤 노드에 접속했느냐에 관계없이 언제나 같은 데이터를 보게 되어야 한다.
- 가용성 : 분산 시스템에 접속하는 모든 클라이언트들은 일부 노드에 장애가 발생하더라도 항상 응답을 받을 수 있어야 한다.
- 파티션 감내 : 파티션은 두 노드 사이에 통신 장애가 발생하였음을 의미한다. 파티션 감내는 네트워크에 파티션이 생기더라도 시스템은 계속 동작하여야 한다는 것을 뜻한다.

