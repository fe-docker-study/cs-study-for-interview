# GSLB

Global Server Load Balancing.

여러 이유나 목적으로, 특정 서비스에 대한 서버가 지리적으로 분산되어 있을 때 (재해 복구, 국제적 진출, 지리적인 목적 등) 서비스를 요청한 클라이언트가 해당 서버들로 도달할 수 있도록 도메인에 대한 로드밸런싱을 해주는 장치.

DNS와 동일하게 도메인 질의에 응답해주는 동시에, LB처럼 등록된 서버들에 대해 헬스체크를 하여 서비스가 정상인 레코드에 대해서만 사용한다.

![img](https://thebook.io/img/007046/266.jpg)



### 동작 방식

ex) 지리적으로 멀리 떨어진 2개의 DC에서 서비스가 가동중

1. 클라이언트가 특정 도메인에 대한 요청 (아래 그림의 예시의 경우, web.zigispace.net)
2. DNS는 해당 요청을 GSLB에 포워딩 
3. GSLB는 각 서비스의 헬스체크 진행
4. GSLB는 로드밸런싱 알고리즘에 따라 각 DC의 서비스 중 하나의 IP를 응답

![img](https://thebook.io/img/007046/267.jpg)



### 분산 방식

- 라운드 로빈, 최소 접속, 해싱 등 외에 다양한 분산방식을 configure 할 수 있다.
- GSLB 장비마다 다르지만 대부분 두 가지 헬스 체크 모니터링을 지원
  - 서비스 응답시간/지연
  - IP에 대한 지리 정보
- 아래와 같은 configure도 가능하다.
  - 재해복구 - DC A, B에 대해 항상 A로만 트래픽을 보내다가, A에 문제가 생겼을 경우 B로 보내고, A가 안정되었을 때 다시 A로 보내도록
  - 지역적 이점 - US의 사용자는 US에 있는 DC A로, Europe의 사용자는 Europe에 있는 DC B로 보내도록



### GSLB의 이점

- 서비스 제공 가능 여부를 체크
- 지리적으로 멀리 떨더진 다른 데이터센터에 트래픽 분산
- 지역적으로 가까운 서비스에 접속해 더 빠른 서비스 제공 가능하도록 분산
- 재해 복구

GSLB는 지리적으로 멀리 떨어진 국내와 해외 사이트로 구성된 경우, 더 큰 효과를 볼 수 있다.



>  ※ DNS 로드밸런싱과의 차이점 :
>
> DNS 로드밸런싱 - DNS에 동일한 레코드 이름으로 여러 IP주소를 설정하여 도메인 질의에 따라 응답받는 IP주소를 나누는 방식.
>
>  GSLB와는 달리 설정된 서비스의 헬스 체크를 하지 않고 질의에 대해 설정된 값을 무조건 응답하므로, 만일 특정 ip의 서비스가 문제가 있는 경우 사용자는 해당 서비스에 접근할 수 없게 된다. 서비스 가용성 향상 방법으로는 부적합하다.

https://www.youtube.com/watch?v=BFBobi0ETBs





# API Gateway

### MSA (MicroService Architecture)

![monolithic vs microservices](https://ulfrid.github.io/static/171970e03c6292ff0acbbc4c93ff9810/fcda8/monolithic-vs-microservices.png)

- 기존의 아키텍처 - 모놀리식 (레거시) : 모든 모듈이 하나의 서비스 내부에 종속 
  - Pros : 단순한 구조, 배포가 간편, End to End 테스트 용이
  - Cons : 빌드시간의 증가, 새로운 기술 적용이 어려움, 규모가 커질수록 복잡도 증가, 코드 전체 이해 어려움
- MSA - 작은 서비스(Microservices) 여러 개가 모여 하나의 시스템을 제공
- 각 서비스는 작고 독립적이며 느슨하게 결합되어 있음 
  → 독립적으로 배포 가능하며, 전체 프로그램 빌드한 뒤 재배치하지 않고도 기존 서비스를 업데이트 할 수 있음
- 서비스가 독립적이므로 클라우드와 컨테이너와 잘 어울리는 아키텍처 (최근 각광받는 이유)
- Pros 
  - 독립적으로 개발 가능
  - 특정 서비스 업데이트 시 전체 프로그램 재배포 불필요
  - 서비스 하나가 다운되더라도 전체 서비스에 영향 끼치지 않음
  - 리소스의 유연한 운용 가능
  - 서비스들의 재사용성, 클라우드환경에 친화적
- Cons
  - 서비스 간 통신방법이 필요
  - 분산 시스템의 복잡성
  - 서비스끼리의 테스트 어려움
  - 통합적인 유지 관리가 어려워질 수 있음



## API Gateway

![API Gateway 소개 (TOAST Service 들여다 보기) : NHN Cloud Meetup](https://image.toast.com/aaaadh/real/2019/techblog/1main.png)MSA를 사용하면 클라이언트와 마이크로서비스 간에 더 많은 API 호출이 발생하게 된다.
이러한 분산시스템에서 API 트래픽을 관리하기 위한 장치가 API Gateway이다.

API Gateway는 클라이언트와 마이크로서비스 사이에 위치하여 모든 API 호출을 받고, 적절한 서비스로 라우팅하는 역할을 한다. 



### API Gateway의 주요 이점

#### 1. 클라이언트 & 백엔드 성능 향상 

클라이언트의 모든 개별 요청을 각 마이크로서비스로 전달하는 대신, API Gateway가 요청을 필터링하고 여러 클라이언트의 요청을 단일 요청으로 대체하도록 한다. 

따라서 클라이언트와 백엔드 간의 트래픽 왕복, API 통신량을 줄여주므로 지연 시간을 줄이고 효율성을 높인다. 더 나은 고객경험을 줄 수 있다.

#### 2. 보안 

클라이언트와 서비스 사이에 보안 장벽으로서의 역할을 할 수 있다. 
또한 API Gateway에 인증, 인가(Authorization), SSL 등의 서비스를 추가하여 보안을 강화할 수 있다. 

#### 3. Protocol 변환

클라이언트의 HTTPS 요청을 HTTP 요청으로 변환하여 마이크로서비스에 전달할 수 있다.

이는 API Gateway에서 SSL Termination(SSL로 암호화된 데이터 트래픽이 오프로드되는 프로세스)이 이루어짐을 의미한다. 즉, API Gateway 내에서 암호화된 SSL 데이터를 복호화하므로, 백엔드 단의 처리 부담을 줄이게 된다.

#### 4. 공통 기능 오프로드

마이크로서비스들의 공통적인 기능의 비즈니스 로직 일부분을 가져와 API Gateway에서 동작하도록 하여 더 효율적이고 원할하게 할 수 있다. API 모니터링과 로깅을 할 수도 있다.
인증서 관리, 인증, 인가 등의 공통 기능을 API Gateway에서 오프로드함으로써 각 서비스의 부담을 줄이고, 서비스 관리 및 업그레이드를 효율적으로 할 수 있다.



https://www.youtube.com/watch?v=hWRRdICvMNs

https://techblog.woowahan.com/2523/