# 포트포워딩

특정 포트로 포워딩을 해주는 작업. 게이트웨이의 특정 포트와 서브넷 디바이스의 포트번호를 연결해주는 것이라고 보면 된다.
예를들어, 사설 IP 주소 대역(10.0.0.1)인 디바이스의 1000번 포트에서 어떤 프로세스가 가동 중이라면 이 1000번 포트에 게이트웨이 라우터의 2000번 포트로 포트포워딩을 해주도록 설정했다고 가정하자.
그러면 외부 인터넷 망에서 게이트웨이 라우터의 공인 IP주소:2000으로 접속 시 10.0.0.1:1000번 포트의 어플리케이션 프로세스와 연결할 수 있게된다.

NAT와의 차이점은 이 매핑관계가 유지가된다는 점이고 NAT의 경우 매핑 시 포트가 임의로 지정되는 반면에 포트포워딩에서는 사용자가 따로 지정할 수 있다.
보통은 게이트웨이의 포트를 사설 아이피의 디바이스 포트와 동일하게 매핑한다.


<img src="https://user-images.githubusercontent.com/31172248/148641723-ffbcc7fe-5a3b-4fbf-8dfe-ba8bf8e3ba45.png" style="width:50%;"/>



## 외부에서 내부로 원격 접속

1. 공인 아이피  
   https://search.naver.com/search.naver?sm=tab_hty.top&where=nexearch&query=%EB%82%B4+%EC%95%84%EC%9D%B4%ED%94%BC&oquery=%EB%82%B4+%EC%95%84%EC%9D%B4%ED%94%BC%27&tqi=hODbFwprvTossSCIEBdssssstyo-323076
2. 사설 아이피

```
# window
ipconfig
.
.
무선 LAN 어댑터 Wi-Fi
    IPv4 주소 192.168.0.104
    .
    .
    기본 게이트웨이 192.168.0.1
    
# mac os
$ netstat -rn
Internet:
Destination        Gateway            Flags        Netif Expire
default            192.168.0.1        UGSc           en0    

$ ipconfig getifaddr en0
xxx.xxx.xxx.xxx
```

3. gateway 접속

### DMZ 존

내외부 네트워크 구간 사이에 위치한 중간지점으로 외부에 서비스 제공 시 내부 자원을 보호하기 위해 내부 네트워크 구간과 외부 네트워크 구간 사이에 접근 제한을 수행한다.
보통 메일 서버, 웹서버, DNS 서버 등이 위치하며 보통 외부에서 내부로의 무분별한 접근을 막기 위해 외부에서 DMZ는 자유롭게 들어울 수 있도록 하고
외부에서 내부로는 들어오지 못하도록 세팅한다.  ㅑ
<img src="https://user-images.githubusercontent.com/31172248/148641800-cdc44f36-e922-40ca-bf0b-68c0cf19b163.png" style="width:150%;"/>


#### DMZ 설정

게이트웨이에서 DMZ 설정 시 외부에서 접근하는 어떤 포트라도 1개의 특정 사설 IP로 통과되도록 할 수 있다. 보안상 문제가 될 수 있으나 DMZ가 메인이 되는 공유기가 받고 있는 IP 주소만
DMZ 설정을 하여 공유기에 부여된 IP 주소를 모두 오픈할 수 있기 때문에 편리하다.

### 방화벽

네트워크를 통과하는 통신을 허용/거부/검열 하는 모듈이다. 방화벽은 물리적으로 네트워크를 절단시키는 구조를 갖고있기 때문에 응용 프로그램을 고칠 필요없이 쉽게 사용할 수 있고,
네트워크에 흘러다니는 모든 패킷을 검사하여 해킹과 같은 외부침입을 근본적으로 막을 수 있다.

#### 인바운드 아웃바운드

```
window + R -> wf.msc
```

| Inbound                                           | Outbound                                        |
| ------------------------------------------------- | ----------------------------------------------- |
| 서버 내부로 들어오는 것(보통 서버에서 클라이언트) | 서버 외부로 나가는 것(보통 서버에서 클라이언트) |
| Windows 방화벽 기본 설정 : 모든 접속 차단         | Windows 방화벽 기본 설정 : 모든 접속 허용       |

- 여기서 들어오고 나가는 대상은 IP, 프로토콜, 포트, 패킷, 호스트, 도메인, 정책 등을 말한다.


#### Window에서 설정하기
* Window Home은 원격 데스크탑을 지원하지 않는다.
1. 시작 - 설정 - 시스템 -> **원격데스크탑** -> 원격 데스크탑 활성화
2. 개인 네트워크에서 PC를 검색할 수 있도록 하여 원격 장치에서 자동 연결 허용 -> 설정표시
3. 개인 -> 네트워크 검색 켜기
4. Windows Defender 방화벽 -> Windows Defender 방화벽을 통해 앱 또는 기능 허용 -> 설정 변경 -> 원격 데스크톱, 원격 지원에 체크
5. 시작 - 설정 - 시스템 -> 원격 데스크탑 -> 사용자 계정 추가

#### mac os 에서 방화벽 포트 설정하기
1. sudo vi /etc/pf.conf 로 접속해
```
pass in proto tcp from any to any port [port number]
2. sudo pfctl -vnf /etc/pf.conf 입력한 포트가 열렸는지 확인한다.
```

## 같은 LAN 대역끼리 원격 접속
