# LAN과 연결장치

2계층에서는 같은 LAN 내에 있는 장비에서 장비로 데이터를 전달한다. 중요한 것은 하나의 LAN 내에서만 통신을 한다는 것이다. 만약 다른 네트워크와 통신 시에는 3계층의 도움이 필요하다. 그렇다면 LAN은 무엇인가?

## 유선 LAN (유선 근거리 통신망)

제한 된 지역에서 독립된 장치들끼리 통신할 수 있게 하는 통신 시스템이다. LAN에서의 대표적인 프로토콜로는 **Ethernet**이 있으며 통신 시 MAC 주소(= Ethernet 주소)를 쓴다. 이 주소의 지정은 16진수 6byte의 형식을 띠고 있다.  
MAC주소는 중간을 기준으로 앞은 OUI(IEEE에서 부여하는 일종의 제조회사 식별 ID)이며, 뒤는 고유번호(제조사에서 부여한 고유 번호)를 갖는다.
![image](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/5ca27fb6-8cfd-4890-a440-651060e3bc82/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20211129%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20211129T123409Z&X-Amz-Expires=86400&X-Amz-Signature=24fd612b26948b4b9ceac898f0b98085dd4b1e06d65e83bf9d1cf203a7cb106b&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject)

- broadcast : mac 주소 전체가 다 1이거나 F인 경우
- unicast : 보내는 사람, 받는 사람을 명확하게 지정하는 경우

### 무선LAN

유선 LAN에 연결하기 위해 무선 AP를 사용한다. 이 때, AP 사정 거리 내 연결된 컴퓨터들의 영역이 LAN이 된다.

## 2계층의 프로토콜 Ethernet

![image](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/1323559e-709b-4f54-9e24-95d09581ef1f/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20211129%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20211129T123625Z&X-Amz-Expires=86400&X-Amz-Signature=06f6c15a4081a958eea09c00b03c51bf5f1327aaa73f057b434745f29c3c59f0&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject)

- Destination Address : 6byte -> 받는 사람의 MAC 주소
- Source Address : 6byte -> 출발지 MAC 주소
- Ethernet Type : 2byte -> 프로토콜 타입이다. payload 안에 있는 3계층 프로토콜 내용을 담고있다.
  (전달된 패킷을 분석할 때 Ethernet Type에 있는 상위 프로토콜 내용을 기반으로 data를 까볼 수 있다.)  
  IPv4의 경우 0800, ARP의 경우 0806의 값을 나타낸다.
- Data(Payload)

### 실습

WireShark로 google.com에 ping을 보냈을 때 노란색 체크박스는 destination address, 초록색 체크박스는 source address 뒤에 2byte는 Ethernet Type을 나타낸다. 여기서 0800인 것으로 보아 Ethernet Type이 IPv4인 것을 알 수 있다.  
하지만, MAC 주소는 사용자가 사용하기엔 너무 복잡하기 때문에 MAC 주소는 컴퓨터끼리 통상적으로 통신할 때 IP주소를 통해 통신한다고 봐도 무방하다.

## 연결장치

간단하게 네트워크 연결장치의 종류들에 대해 알아보자.

1. LAN 카드 : 두 대 이상의 컴퓨터로 네트워크를 구성하기 위해 네트워크와 빠른 속도로 데이터를 송수신할 수 있도록 컴퓨터 내에 설치하는 확장카드이다. 전송 매체에 접속하는 역할과 데이터의 입출력 및 손수신, 프로토콜의 처리 등을 담당한다. LAN 카드에는 주민등록번호처럼 고유 식별 코드가 있는데 이렇게 LAN 카드에 할당된 48 bit의 물리적 주소를 MAC 주소라고 한다.

2. Hub : 여러 대의 컴퓨터를 연결하여 같은 네트워크를 만들어주는 장치이다. 여러 개의 입출력 포트를 가지고 있으며 단순 전기 신호 복제기라고 볼 수도 있다. 허브는 리피터역할가 멀티포트 역할을 많이하는데, 리피터의 경우 감소된 신호를 증폭하는 역할을 한다. 일반적인 UTP 케이블의 경우 케이블의 길이가 100m를 넘게 되면 신호가 감쇠하게된다. 이 때 두개의 UTP 케이블 사이에 허브를 설치하면 100m 넘게 통신할 수 있다. 결국 컴퓨터는 이 UDP를 사용해 허브의 각 포트에 연결되고 데이터는 허브를 통과해 다른 컴퓨터로 데이터를 전송하게된다.

3. Switch : 허브의 경우 허브와 연결된 컴퓨터는 Collision Domain 문제 때문에 하나의 허브에 여러 개의 컴퓨터를 연결해 사용할 수 없다. (https://kosaf04pyh.tistory.com/208 참고) 스위치는 이 문제를 해결할 수 있다. 스위치는 수신한 데이터를 연결된 모든 컴퓨터에게 전송하는 허브와는 달리 정확한 목적지 컴퓨터에게만 데이터를 전송한다. 자신에게 연결된 디바이스들의 IP와 MAC 주소를 테이블로 가지고 있기 때문이다. 따라서 데이터가 자신에게 오면 그것의 목적지가 어디인지를 파악하여 해당 컴퓨터에게 데이터를 내보내준다.  
   OSI 7 Layer에서 스위치는 어떤 주소를 가지고 스위칭을 하는가에 따라 L2, L3, L4, L7로 나눌 수 있으며 일반적으로 높은 계층을 다루는 스위치일 수록 비싸며, 하위 계층의 스위치 기능을 할 수 있다.

[참고]

- L1 스위치 : 단순히 패킷 전달  
  허브, 리피터기능을 하며 따로 데이터를 관리하지 않습니다. 단순히 수신한 패킷을 다른 모든 컴퓨터에게 보내는 역할을 하며, 패킷이 반복되서 복제되는데 이로 인해 패킷의 충돌이 증가합니다. 이는 네트워크 스위치의 성능을 제한하는 주요 원인이 됩니다.

- L2 스위치 : MAC 정보로 스위칭  
  데이터 링크 계층에서 작동하는 네트워크 비릿지로 가정이나 소규모 사무실에서 적은 수의 디바이스를 연결하기 위해 사용합니다. 이 네트워크 장비는 연결된 디바이스의 MAC주소를 저장하고, 이 정보를 이용해서 스위칭합니다. 구성이 단순해서 많은 기능을 제공하지는 않지만, 단순한 만큼 매우 높은 성능을 보여주기 때문에 ,SAN(Storage Area Network) 등의 특수한 목적에 주로 사용합니다.

- L3 스위치 : IP 정보로 스위칭  
  L3스위치는 라우터라고 하며 L2기능에서 라우팅 기능을 수행할 수 있습니다. IGMP를 이용해서 IP 멀티캐스트 기능을 지원하며 멀티 캐스트 기능을 이용하면 네트워크 종단에서 패킷을 받기 원하는 디바이스에게 패킷을 복사할 수 있기 때문에 트랙픽 효율성을 높일 수 있습니다.

- L4 스위치 : Port 정보로 스위칭  
  L3스위치의 기능에 더해 서버나 네트워크의 트래픽을 로드밸런싱, 즉 균등하게 분배해주는 기능을 합니다. 이때 TCP와 UDP 그리고 RTP(Real Time Protocol) 등의 헤더를 사용하여 FTP, HTTP, TFTP, SMTP 등의 프로토콜 중 어느것에 대한 요구가 우선하는지 파악한 후 스위칭하게 됩니다.

- L7 : 어플리케이션의 데이터를 보고 스위칭  
  payload(이메일 제목/내용의 문자열, HTTP 컨텐츠 URL, FTP 파일제목, SSL, ID, Cookie 정보, 특정 바이러스)특성들을 분석해 패킷을 처리합니다. 또한 보안에 이용되어지는데 보다 높은 수준의 Intelligence를 갖춘 스위치이므로 더정교한 패킷의 부하 분산 및 QOS기능 구현이 가능합니다.

4. 라우터 : 여러 개의 독립된 네트워크를 연결, 분할, 구분 시켜주는 역할을 한다. 서로 구조가 다른 망을 연결할 수 있어 LAN, WAN, 을 연결하는데 사용한다. 방화벽 같은 1차적인 보안기능을 제공하며, 비용은 허브나 스위치보다 싸다. 사실상 라우터는 L3 스위치이다. 패킷이 전송될 때 여러 라우터를 거치게되는데 각각의 라우터는 현재 자신의 상태를 공유한다. 인접한 라우터의 상태를 알고 있어야 그곳으로 패킷을 보낼 지 다른 곳으로 보낼지 결정할 수 있기 때문. 여기서 다른 라우터와 어떤 프로토콜을 통해 자신의 상태를 공유하고 있는 L3 스위치를 라우터라고 한다. 즉, 라우팅 프로토콜을 지원하는 L3 스위치가 라우터이다.

5. 브릿지 :
   OSI 7 Layer 2계층에서 동작하는 장치로 MAC 주소 테이블을 가지고 있어, 허브와 리피터와 다르게 해당 목적이 MAC 주소를 가진 장비가 연결된 포트로만 패킷을 전송한다. 현재는 스위치가 그 기능을 대신함.

6. 게이트웨이 : 종류가 다른 두 개 이상의 네트워크를 상호 접속하여 정보를 주고 받을 수 있는 장치이다. 서로 다른 프로토콜 통신망 간에도 프로토콜을 변환하여 통신 가능.

7. 중계기 : 신호를 증폭시키고, 목적지까지 안전하게가게한다.
